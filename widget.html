<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script src="template.js"></script>
<script src="api_key.js"></script>
<script>
  function api_call(path, params) {
    return "http://api.meetup.com/" + path + "?callback=?&" + $.param($.extend({ key: $api_key, sign: true }, params));
  }
  var github = "http://github.com/api/v2/json/";
  var widgetrepo = "widgets";
  var cbq = "?callback=?";
  var config_re = /\/\/ *widget config/
  $(function() {
    $.getJSON(github + "commits/list/meetup/" + widgetrepo + "/master" + cbq, function(json) {
      var head = json.commits[0].id
      $.getJSON(github + "tree/show/meetup/" + widgetrepo + "/" + head + cbq, function(json) {
        $.each(json.tree, function(i, item) {
          if (item.name.match(/.html$/))
            $.getJSON(github + "blob/show/meetup/" + widgetrepo + "/" + head + "/" + item.name + cbq, function(json) {
              var parts = json.blob.data.split(config_re)
              if (parts.length == 3) {
                eval(parts[1]);
                for (i in $queries)
                  alert("query: " + i + " is " + $queries[i]());
                $("#results").append(parseTemplate($("#listing").html(), json.blob));
              }
            });
        });
      });
    });
  });
</script>
<script id="listing" type="text/html">
  <h3><#= name #></h3>
  <textarea><#= data #></textarea> 
</script>
<body>
  <div id="results"></div>
</body>
</html>
