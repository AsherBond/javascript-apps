
var groupname_area = "";
var peoplecount_area = "";
var logo_area = "";
var time_date_area = "";
var map_temp = "";
var map_pic = "";

var webaddress = "";

var groupname = "techcrunch";
var size = 200;

function gup( name )
{
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return "";
  else
    return results[1];
}

var test = gup("name");
alert(test);


$.getJSON("http://api.meetup.com/ew/containers?urlname="+ groupname +"&key=2965376f4a27313c71736b6a27c7024&callback=?", function(data) {
      	if (data.status && data.status.match(/^200/) == null) {
       		alert(data.status + ": " + data.details);
      	} else {
       		$.each(data.results, function(i, ev) {
			if (i==0) {
				webaddress = ev.meetup_url;
				//TBD - pull user and group counts out somehow
				groupname_area = groupname_area.concat("<span class=\"MEETUP_EVERYWHERE_WIDGET_count\">290 </span><span class=\"MEETUP_EVERYWHERE_WIDGET_name\">"+ ev.name +" </span><span class=\"MEETUP_EVERYWHERE_WIDGET_suffix\"> Meetups</span>");
				peoplecount_area = peoplecount_area.concat("<span class=techcrunch\"MEETUP_EVERYWHERE_WIDGET_people\">2,213 People</span>");
				logo_area = logo_area.concat("<a class=\"MEETUP_EVERYWHERE_WIDGET_logo\" href=\"" + ev.meetup_url + "\"><img class=\"MEETUP_EVERYWHERE_WIDGET_bottom_logo\" src=\"http://img1.meetupstatic.com/84869143793177372874/img/birddog/everywhere_widget.png\"/></a>");
			}
        	});
      	}

});

$.getJSON("http://api.meetup.com/ew/events?urlname="+ groupname +"&key=2965376f4a27313c71736b6a27c7024&callback=?", function(data) {
	if (data.status && data.status.match(/^200/) == null) {
       		alert(data.status + ": " + data.details);
      	} else {
		$.each(data.results, function(i, ev) {
			if (i==0) {
				//FORMAT TIME AND DATE
				var myDate = new Date( ev.time*1000);
				var h = myDate.getHours();
				var m = myDate.getMinutes();
				var time_out = "";
				var time = "AM";	

				if (h >= 12) {time = "PM";}
				if (h > 12) { h = h - 12;}
				if (m > 9) { time_out = (h + ":" + m + " " + time);}
				else {time_out = (h + ":0" + m + " " + time);}

				var month_out = "";
				switch (myDate.getMonth())
				{
				case 0:
  					month_out = ("Jan");
					break;
				case 1:
					month_out =  ("Feb");
					break;
				case 2:
  					month_out =  ("Mar");
					break;
				case 3:
					month_out =  ("Apr");
					break;
				case 4:
					month_out =  ("May");
					break;
				case 5:
					month_out =  ("Jun");
					break;
				case 6:
					month_out =  ("Jul");
					break;
				case 7:
					month_out =  ("Aug");
					break;
				case 8:
					month_out =  ("Sep");
					break;
				case 9:
					month_out =  ("Oct");
					break;
				case 10:
					month_out =  ("Nov");
					break;
				case 11:
					month_out =  ("Dec");
					break;
				default:
					month_out =  ("Undef");
				}

				time_date_area = time_date_area.concat("<a href=\"" + ev.meetup_url + "\"><span class=\"when birddogData\"><span class=\"date\">" + month_out + " " + (myDate.getDay() + 1) + "</span><span class=\"time\">"+ time_out + "</span></span><span class=\"loc birddogData\"><span class=\"city linked\">" + ev.city+ ", " + ev.country.toUpperCase() + "</span></span></a><a href=\""+ ev.meetup_url + "\"><span class=\"MEETUP_EVERYWHERE_WIDGET_all\">See all<span class=\"MEETUP_EVERYWHERE_WIDGET_go\">></span></span></a>");
			}
			// MAP GENERATOR
			if (i < 50) {
				map_temp = map_temp.concat("|" + ev.lat + "," + ev.lon);
			}
		});
		var mapw = size - 16;
		var mapv = mapw/2;
		map_pic = map_pic.concat("<img src=\"http://maps.google.com/maps/api/staticmap?zoom=0&size="+mapw+"x"+mapv+"&maptype=roadmap&markers=color:red|size:tiny" + map_temp + "&sensor=false\"/>");
	}	
});

document.write("<style type=\"text\/css\">\n.MEETUP_EVERYWHERE_WIDGET{\nbackground: #1a1a1a;\n-moz-border-radius: 4px;\n-webkit-border-radius: 4px;\nborder-radius: 4px;\nwidth: " + size +"px;\nfont-family: verdana, sans-serif;\n}\n.MEETUP_EVERYWHERE_WIDGET_body{\npadding: 8px;\n}\n.MEETUP_EVERYWHERE_WIDGET_total a{\ndisplay: block;\ncolor: #fff;\ntext-decoration: none;\n}\n.MEETUP_EVERYWHERE_WIDGET a img{\nborder: 0!important;\n}\n.MEETUP_EVERYWHERE_WIDGET_total a img{\nmargin: 4px 0;\n}\n.MEETUP_EVERYWHERE_WIDGET_title{\ndisplay: block;\nfont-family: arial, sans-serif;\nfont-weight: bold;\nletter-spacing: -1px;\nline-height: 1.2em;\n}\n.MEETUP_EVERYWHERE_WIDGET_total .MEETUP_EVERYWHERE_WIDGET_title{\nfont-size: 22px;\n}\n.MEETUP_EVERYWHERE_WIDGET_name{\n}\n.MEETUP_EVERYWHERE_WIDGET_logo{\ndisplay: block;\ntext-align: left;\n}\n.MEETUP_EVERYWHERE_WIDGET_people{\nfont-size: 12px;\ndisplay: block;\n}\n.MEETUP_EVERYWHERE_WIDGET_suffix{\ncolor: #aaa;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby .MEETUP_EVERYWHERE_WIDGET_title{\nfont-size: 14px;\ncolor: #aaa;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby .MEETUP_EVERYWHERE_WIDGET_nearby_list{\n-moz-border-radius: 4px;\n-webkit-border-radius: 4px;\nborder-radius: 4px;\ndisplay: block;\nbackground: #333;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby .MEETUP_EVERYWHERE_WIDGET_nearby_list a{\nzoom: 1;\nborder-top: 1px solid #1a1a1a!important;\npadding: 8px 10px;\ndisplay: block;\nfont-size: 12px;\ncolor: #fff;\ntext-decoration: none;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby .MEETUP_EVERYWHERE_WIDGET_nearby_list a:after{\ncontent: \".\";\ndisplay: block;\nheight: 0;\nclear: both;\nvisibility: hidden; }\n.MEETUP_EVERYWHERE_WIDGET_nearby .MEETUP_EVERYWHERE_WIDGET_nearby_list a:hover{\nbackground: #a3e4ff;\ncolor: #3c3633 !important;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby .MEETUP_EVERYWHERE_WIDGET_nearby_list a{\npadding: 6px 10px;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby .MEETUP_EVERYWHERE_WIDGET_nearby_list a .MEETUP_EVERYWHERE_WIDGET_all{\ndisplay: block;\ntext-align: right;\ndisplay: block;\nfont-family: arial, sans-serif;\nfont-weight: bold;\n\/*\ntext-transform: lowercase;\nfont-variant: small-caps;\n*\/\nfont-size: 11.399999999999999px;\n}\n.MEETUP_EVERYWHERE_WIDGET_bottom_logo{\nmargin-top: 8px;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby a .when{\ndisplay: block;\nfloat: left;\nwidth: 4em;\ntext-align: right;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby a .loc{\nmargin-left: 4.35em;\npadding-left: .35em;\nborder-left: 1px dotted #555;\ndisplay: block;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby a .loc .city{\nfont-weight: bold;\n}\n.MEETUP_EVERYWHERE_WIDGET_nearby a .when .time,\n.MEETUP_EVERYWHERE_WIDGET_nearby a .loc .address{\nfont-size: 10.2px;\ndisplay: block;\n}\n.MEETUP_EVERYWHERE_WIDGET_go{\nbackground-color: #ca3e47;\nbackground-image: -moz-linear-gradient(top, #ca3e47, #a8252e);\nbackground-image: -webkit-gradient(linear,left bottom,left top,color-stop(0, #a8252e),color-stop(1, #ca3e47));\nfilter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ca3e47', endColorstr='#a8252e');\nborder: 2px solid #a8252e;\n-moz-border-radius: 4px 4px 4px 4px;\n-webkit-border-radius: 4px;\nborder-radius: 4px 4px 4px 4px;\ntext-shadow: black 0px 0px 2px;\nzoom: 1;\ndisplay: inline;\ndisplay: inline-block;\ntext-align: center;\nfont-weight: bold;\nfont-size: 15px;\nmargin-left: 2px;\nline-height: .75em;\ncolor: #fff!important;\nfont-family: arial;\npadding: 0px 4px;\ncursor: pointer;\ncursor: hand;\n}\n<\/style>");

alert(groupname_area + peoplecount_area + logo_area + time_date_area + map_pic + webaddress);


document.write("<div class=\"MEETUP_EVERYWHERE_WIDGET\" id=\"MEETUP_EVERYWHERE_WIDGET_28\">\n<div class=\"MEETUP_EVERYWHERE_WIDGET_body\">\n<div class=\"MEETUP_EVERYWHERE_WIDGET_total\">\n<a href=\"" + webaddress +"\">\n<span class=\"MEETUP_EVERYWHERE_WIDGET_title\">\n" + groupname_area +"\n</span>\n" + peoplecount_area + "\n" + map_pic + "\n</a>\n</div>\n<div class=\"MEETUP_EVERYWHERE_WIDGET_nearby\">\n<div class=\"MEETUP_EVERYWHERE_WIDGET_nearby_list\">\n"+ time_date_area + "\n</div>\n</div>\n" + logo_area + "\n</div>\n</div>");
